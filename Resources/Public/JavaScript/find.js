var tx_find=function(){var e,t={load:function(){if(!window.google||!window.google.maps){var e=document.createElement("script");e.type="text/javascript",e.src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&callback=tx_find.googleMapsLoader.mapsCallback",document.body.appendChild(e)}},mapsCallback:function(){jQuery(document).trigger("tx_find.mapsLoaded")}},r=function(e,t){var r=t.selected,a=jQuery(this).parents("article"),n=jQuery("li[value='"+r+"']",a);1===n.length&&jQuery("a",n)[0].click()};var a=function(){var t=jQuery(".searchForm",e),r=jQuery(this);return!t.hasClass("search-extended")?(r.text(this.getAttribute("extendedstring")),jQuery(".field-mode-extended",t).slideDown("fast"),n("extended",1),$(".field-mode-extended").css("display","grid")):(r.text(this.getAttribute("simplestring")),jQuery(".field-mode-extended",t).slideUp("fast"),n("extended")),t.toggleClass("search-simple").toggleClass("search-extended"),!1},n=function(t,r){var a="tx_find_find["+t+"]",n=i(location.href,a);void 0!==r&&(n=o(n,a,r)),l(n),jQuery("a:not(.no-change)",e).each(function(){this.href=void 0!==r?o(this.href,a,r):i(this.href,a)}),jQuery("input."+a,e).each(function(){void 0!==r?this.setAttribute("name","tx_find_find["+a+"]"):this.setAttribute("name","")})},o=function(e,t,r){var a=encodeURIComponent(t),n=encodeURIComponent(r),o=e.split("#");return o[0]+=(o[0].match(/\?/)?"&":"?")+a+"="+n,o.join("#")},i=function(e,t){var r=encodeURIComponent(t),a=new RegExp("&?"+r+"=[^&]*");return e.replace(a,"").replace(/\?$/,"")},l=function(e){void 0!==history.pushState&&history.pushState(null,null,e)};return $.widget("custom.catcomplete",$.ui.autocomplete,{_create:function(){this._super(),this.widget().menu("option","items","> :not(.ui-autocomplete-category)")},_renderMenu:function(e,t){var r=this,a="";$.each(t,function(t,n){var o;n.category!=a&&(e.append("<li class='ui-autocomplete-category'>"+n.categoryLabel+"</li>"),a=n.category),o=r._renderItemData(e,n),n.category&&o.attr("aria-label",n.categoryLabel+" : "+n.label)})}}),jQuery(document).ready(function(){e=jQuery(".tx_find"),jQuery.ui&&jQuery.ui.autocomplete&&(jQuery('.fieldContainer input[autocompleteURL!=""]',e).catcomplete({minLength:2,source:function(e,t){var r=this.element.attr("autocompleteURL");if(r){let a=e.term.toLowerCase().trim();r=r.replace("%25%25%25%25",a),jQuery.getJSON(r,function(r){let n=[];r.forEach(function(e){n.push({label:e,category:"query",categoryLabel:Localization.getString("querySuggestions")})});let o=[],i=mahu.getTaxonomy().listMaterialClasses();for(let e=0;e<i.length;++e){let t=i[e],r=a.split(" ");for(let e=0;e<r.length;++e){let a=r[e];if(a.length<2)continue;let n=Localization.getString(t);if(-1!=t.toLowerCase().indexOf(a)||-1!=n.toLowerCase().indexOf(a)){let e={category:"filter",categoryLabel:Localization.getString("addFilter"),label:Localization.getString("matClass")+" = "+n,value:t,id:"category"};o.push(e);break}}}o=o.slice(0,5),n=n.concat(o),mahuUtils.querySchema().done(function(r){if(r.properties){let t=Object.getOwnPropertyNames(r.properties);for(let i=0;i<t.length;++i){let l=r.properties[t[i]],s=Localization.getString(l.id),c=null,d=-1,u=a.split(" ");for(let e=0;e<u.length;++e){let t=u[e];if(t.length>2&&-1!=s.toLowerCase().indexOf(t)){c={category:"filter",categoryLabel:Localization.getString("addFilter"),propertyLabel:s,label:s+" = *",id:l.id,prop:l},d=e;break}}if(c){if(u.length>1)if(u.splice(d,1),c.prop.isQualitative){let t=e.term.trim().split(" ");t.splice(d,1),c.from=t[0],c.label=c.propertyLabel+" = "+t[0]}else{let e=[];for(let t=0;t<u.length;++t){let r=u[t];if(isNaN(r)){if(/\d/.test(r)){let t=r.replaceAll(/[^0-9,.]/g," ").replaceAll(/\s+/g," ").trim().split(" ");for(let r=0;r<t.length;++r){let a=t[r];isNaN(a)||e.push(parseFloat(a))}}}else e.push(parseFloat(r))}1==e.length&&(c.from=e[0],c.label=c.propertyLabel+" >= "+e[0]),e.length>1&&(e.sort(function(e,t){return e-t}),c.from=e[0],c.to=e[1],c.label=c.propertyLabel+" = "+e[0]+"-"+e[1])}if(n.push(c),o.length>0)for(let e=0;e<o.length;++e){let t=o[e];n.push({category:"filter",categoryLabel:Localization.getString("addFilter"),label:t.label+" und "+c.label,children:[t,c]})}}}}t(n.slice(0,30))})})}},select:function(e,t){let r=t.item;if("query"==r.category){if($("#extendedSearchOptions .field-mode-extended").is(":visible"))return;e.preventDefault(),e.stopPropagation(),this.value=t.item.value,$("form[class~='searchForm']").submit()}else if(Array.isArray(r.children))e.preventDefault(),e.stopPropagation(),this.value="",mahu.getCurrentPage().addRequirementTag({unit:r.children[1].prop.defaultUnit||void 0,property:r.children[1].prop,from:r.children[1].from,to:r.children[1].to},!0),setTimeout(function(){let e=document.createElement("input");e.value="1",e.type="hidden",e.name="tx_find_find[facet][category]["+r.children[0].value+"]",$("form.searchForm").append(e),$("form.searchForm button.submit").click()},100);else if(e.preventDefault(),e.stopPropagation(),this.value="","category"==r.id){let e=document.createElement("input");e.value="1",e.type="hidden",e.name="tx_find_find[facet][category]["+r.value+"]",$("form.searchForm").append(e),$("form.searchForm button.submit").click()}else mahu.getCurrentPage().addRequirementTag({unit:r.prop.defaultUnit||void 0,property:r.prop,from:r.from,to:r.to},!0),$(".searchForm").hasClass("search-extended")||$(".searchForm .hero-unit .controls a.extendedSearch").click()}}),jQuery(".facetSearch",e).each(function(){jQuery(this).chosen({width:"100%;"}).bind("change",r)})),jQuery("a.extendedSearch",e).click(a)}),{showAllFacetsOfType:function(e){let t=jQuery(e.currentTarget),r=t.parents("ol")[0],a=jQuery(".hidden",r);a.slideDown(300),a.removeClass("hidden").addClass("shown"),t.attr("onclick","return tx_find.hideFacetsOfType(event)");let n=t.children();return t.text(Localization.getString("facets.showLess")).prepend(n),e.stopPropagation(),!1},hideFacetsOfType:function(e){let t=jQuery(e.currentTarget),r=t.parents("ol")[0],a=jQuery(".shown",r);a.switchClass("shown","hidden"),t.attr("onclick","return tx_find.showAllFacetsOfType(event)");let n=a.length,o=t.children();return t.text(String.format(Localization.getString("facets.showMore"),n)).prepend(o),!1},createHistogramForTermsInContainer:function(t,r,a){var n=jQuery(r),o=n.parents(".facets").width();n.css({width:o+"px",height:"150px",position:"relative"});var i=[];for(var l in t){var s=parseInt(l,10);s&&i.push([s,t[l]])}var c=jQuery(".facetAdd",e).css("color"),d=jQuery(".facet h1",e).css("color"),u={series:{bars:{show:!0,fill:!0,lineWidth:0,barWidth:a.barWidth,fillColor:"grey"}},xaxis:{tickDecimals:0,ticks:function(e){return[[e.datamin,"      "+e.datamin],[e.datamax,e.datamax+"      "]]},autoscaleMargin:null},yaxis:{position:"right",tickDecimals:0,tickFormatter:function(e,t){return 0!=e?e:""},labelWidth:30},grid:{borderWidth:0,hoverable:!0},selection:{mode:"x",color:d,minSize:0}},p=jQuery.plot(n,[{data:i,color:c}],u);n.parent().resize(function(e){let t=$(e.target);n.width(t.width()),n.height(t.height())});var f=jQuery("#tx_pazpar2-histogram-tooltip");if(0===f.length){var g=document.createElement("div");g.setAttribute("id","tx_find-histogram-tooltip"),f=jQuery(g).appendTo(document.body)}for(var h in a.activeFacets){var m=a.activeFacets[h].match(/RANGE (.*) TO (.*)/);if(m){var y={};y.from=parseInt(m[1]),y.to=parseInt(m[2]),p.setSelection({xaxis:y})}}var v=function(e){var t={},r=Math.floor(e.from);t.from=r-r%a.barWidth;var n=Math.ceil(e.to);return t.to=n-n%a.barWidth+a.barWidth,t},x=function(e){var t=v(e.xaxis);p.setSelection({xaxis:t},!0),b(),function(e){var t="RANGE%20"+e.from+"%20TO%20"+e.to;if(mahuUtils.usesPostRequests()){let e=document.createElement("input");e.type="hidden",e.name="tx_find_find[facet]["+a.facetID+"]["+unescape(t)+"]",e.value="1";let r=$("form.searchForm")[0];r.appendChild(e),r.submit()}else{var n=jQuery(".link-template",jQuery(r).parent())[0].href.replace("%25%25%25%25",t);window.location.href=n}}(t)};n.bind("plotclick",function(e,t,r){return!0}),n.bind("plotselected",function(e,t){x(t)}),n.bind("plotunselected",function(){return!1});var b=function(){f.hide()},L=function(e,o,i){var l,s,c,d=n.offset().top+150-20;if(o)if(r.currentSelection&&r.currentSelection.xaxis){var u=v(o.xaxis);h=u.from.toString()+"-"+u.to.toString()}else{var p=Math.floor(o.xaxis.from);if(p-=p%a.barWidth,t[p])var g=t[p],h=p.toString()+": "+g+" Treffer"}h?(l=i,s=d,c=h,f.text(c),l&&f.css({top:s-20,left:l+5}),f.show()):b()};n.bind("plothover",function(e,t,r){L(0,{xaxis:{from:t.x,to:t.x}},t.pageX)}),n.bind("plotselecting",function(e,t){r.currentSelection=t,L(0,t)}),n.mouseout(b)},detailViewWithPaging:function(t,r,a=window.event){var n=function(e,t){var r=[];for(var a in t){var i=e+"["+a+"]",l=t[a];"object"==typeof l?r=r.concat(n(i,l)):r.push(o(i,l))}return r},o=function(e,t){var r=document.createElement("input");return r.name=e,r.value=t,r.type="hidden",r};if(underlyingQuery){var i=jQuery(t).parents("li"),l=i.parents("ul.resultList");r?underlyingQuery.position=r:l&&(underlyingQuery.position=parseInt(l.attr("start"))+parseInt(i.index()));var s=document.createElement("form"),c=t.getAttribute("href");s.action=c,s.method="POST",s.style="display:none;",document.body.appendChild(s);var d=n("tx_find_find[underlyingQuery]",underlyingQuery);for(var u in d)s.appendChild(d[u]);return jQuery(".searchForm.search-extended",e).length>0&&s.appendChild(o("tx_find_find[extended]","1")),(2==a.which||a.ctrlKey||a.metaKey)&&(s.target="_blank",a.preventDefault()),result=s.submit(),!1}return!0},toggleExtendedSearch:a,googleMapsLoader:t,changeURLParameterForPage:n,addURLParameter:o,removeURLParameter:i,changeURL:l,URLParameterPrefix:"tx_find_find"}}(),tx_find_facetMap=function(){var e,t,r={},a={};r.markers=a;r.init=function(t){e=t,r.config=e,void 0!==document.google&&google.maps?n():(jQuery(document).bind("tx_find.mapsLoaded",n),tx_find.googleMapsLoader.load())};var n=function(){var n={},o=0;for(var i in e.facetData){var l=i.split("-");if(2===l.length){var s=parseInt(l[0]);o=s,n[s]||(n[s]={}),n[s][l[1]]=e.facetData[i]}}Object.keys(e.facetData).length<e.facetFetchMaximum||o--;var c={mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!1,streetViewControl:!1,scrollwheel:!1};t=new google.maps.Map(e.container,c),r.map=t;var d=new google.maps.LatLngBounds,u=n[o];for(var p in u){var f=geohash.bbox(p),g=new google.maps.LatLngBounds(new google.maps.LatLng(f.s,f.w),new google.maps.LatLng(f.n,f.e));d.union(g)}var h=d.toSpan(),m=new google.maps.LatLngBounds(new google.maps.LatLng(d.getSouthWest().lat()+.2*h.lat(),d.getSouthWest().lng()+.2*h.lng()),new google.maps.LatLng(d.getNorthEast().lat()-.2*h.lat(),d.getNorthEast().lng()-.2*h.lng())),y=m.getCenter();g=m.extend(new google.maps.LatLng(y.lat()-.01,y.lng()-.01)).extend(new google.maps.LatLng(y.lat()+.01,y.lng()+.01));t.fitBounds(m);for(var v=0,x=1;x<=o;x++)Object.keys(n[x]).length<100&&(v=x);for(var p in u=n[v]){var b=geohash.decode_exactly(p),L=new google.maps.LatLng(b[0],b[1]),w=u[p],j=new google.maps.Marker({map:t,position:L,title:w.toString(),icon:{path:google.maps.SymbolPath.CIRCLE,strokeColor:"e33",fillColor:"f33",fillOpacity:1,scale:.5+Math.min(Math.sqrt(w),5)}});a[p]=j}jQuery(e.container).trigger("tx_find.facetMapLoaded")};return r}();Object.keys||(Object.keys=function(e){var t,r=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&r.push(t);return r});