class SupplementEditorPage extends AbstractPage{render(){super.render()}addListeners(){super.addListeners();let t=this;$(".editform :input:not(textarea):not(:submit)").on("keydown",function(t){if(13==t.keyCode)return t.preventDefault(),!1}),$(".editform #abort").click(function(t){t.preventDefault(),t.stopPropagation();let e=$(this).attr("data-url");e&&(window.location=e)});const e=function(t){let e=t.getAttribute("data-autocomplete"),a=mahu.getTermLink(e,"json-all");a&&jQuery.getJSON(a,function(a){let n=[],r=a.terms[e];for(let t=0;t<r.length;t+=2)n.push(r[t]);n.sort(function(t,e){return t.localeCompare(e,Localization.getLanguage(),{sensitivity:"base"})}),$(t).autocomplete({source:n,minLength:0}).focus(function(e){if(""!=e.target.value)return;let a=$.Event("keydown");a.key=40,$(t).trigger(a)})})};$("input[data-autocomplete]").each(function(t,a){e(a)}),$("#addPPSelector").chosen(),$("#fabricators select.chosen-container").chosen();const a=function(t){let a=t.parent().find(".cloneable").length,i=t.clone();i.attr("id",""),i.removeClass("noremove");let o=$(i.find("input, textarea, select"));for(let t=0;t<o.length;++t){let n=o[t],r=n.getAttribute("data-nametemplate").replace("$num$",a),i=n.getAttribute("id")+"_"+a;n.setAttribute("name",r),n.setAttribute("id",i),$(n).val(""),n.getAttribute("data-autocomplete")&&e(n);let l=$(n).parents("div.form-group").find("label");0!=l.length&&l[0].setAttribute("for",i)}$("a.removeBtn",i).removeClass("template"),t.parent().append(i),i.find("a.removeBtn").click(function(t){r($(t.currentTarget))}),n(i),$($("input",i)[0]).focus()},n=function(e){let a=$("select.units",e);for(let e=0;e<a.length;++e){let n=a[e];$(n).empty();let r=$(n).parents("div.propertyFields")[0].getAttribute("data-pid"),i=t.schema.properties[r];if(Array.isArray(i.units))for(let t=0;t<i.units.length;++t){let e=i.units[t],a=document.createElement("option");a.value=e,a.innerHTML=e,0==t&&(a.selected="selected"),n.appendChild(a)}else{let t=document.createElement("option");t.value=i.defaultUnit,t.innerHTML=i.defaultUnit,t.selected="selected",n.appendChild(t)}}};$("a.addBtn").click(function(t){a($("#"+t.currentTarget.getAttribute("data-clonetarget")))});const r=function(t){let e=t.parent().parent();1==e.parent().find(".cloneable").length?e.hasClass("noremove")?e.find("input,textarea").val(""):e.parent().remove():e.hasClass("noremove")?e.find("input,textarea").val(""):e.remove()};$("a.removeBtn").click(function(t){r($(t.currentTarget))}),$("#addPPBtn").click(function(t){let e=$("#addPPSelector").val(),i=$("div[data-pid='"+e+"']");if(i.length>0)return void $("a.addBtn",i).click();let o=$("#physicalPropertiesTemplate > div").clone();o.find("input, textarea, select").each(function(t,a){let n=$(a);n.attr("id",n.attr("id").replace("$prop$",e)),n.attr("name",n.attr("name").replace("$prop$",e)),n.attr("data-nametemplate",n.attr("data-nametemplate").replace("$prop$",e))});let l=o.find("label.control-label");l.attr("for",l.attr("for").replace("$prop$",e)).text(Localization.getString(e)),o.find(".form-group label").each(function(t,a){a.setAttribute("for",a.getAttribute("for").replace("$prop$",e))});let c=o.find("a.addBtn");c.attr("data-clonetarget",c.attr("data-clonetarget").replace("$prop$",e));let d=o.find("div.cloneable");d.attr("id",d.attr("id").replace("$prop$",e)),$("#physicalPropertiesFieldsets").append(o),o.find("a.addBtn").click(function(t){a($("#"+t.currentTarget.getAttribute("data-clonetarget")))}),o.find("a.removeBtn").click(function(t){r($(t.currentTarget))}),o.attr("data-pid",o.attr("data-pid").replace("$prop$",e)),$($("input",o)[0]).focus(),n(o)}),$("#addFabricatorBtn").click(function(t){let e=$("#fabricators").find(".cloneable").length,a=$("#involvedTemplate > div").clone(),n=$(a.find("input, textarea, select"));for(let t=0;t<n.length;++t){let a=n[t],r=a.getAttribute("data-nametemplate").replace("$num$",e),i=a.getAttribute("id")+"_"+e;a.setAttribute("name",r),a.setAttribute("id",i),$(a).val("");let o=$(a).parents("div.form-group").find("label");0!=o.length&&o[0].setAttribute("for",i)}$("#fabricators").append(a),a.find("select.chosen-container").chosen(),a.find("a.removeBtn").click(function(t){r($(t.currentTarget))}),$($("input",a)[0]).focus()}),setInterval(function(){let t=$("form.editform")[0];if(!t.checkValidity())return;let e=t.action.replace("tx_mahufrontend_supplementeditor%5Baction%5D=edit","tx_mahufrontend_supplementeditor%5Baction%5D=autosave");e=e.replace("tx_mahufrontend_supplementeditor%5Baction%5D=new","tx_mahufrontend_supplementeditor%5Baction%5D=autosave"),fetch(e+"&tx_mahufrontend_supplementeditor[format]=data&type=1369315165",{method:t.method,body:new FormData(t)}).then(t=>t.json()).then(function(t){t.success&&$.notify({message:String.format(Localization.getString("matedit.autosave"),t.file),icon:"fa fa-save smallicon"},{type:"info",delay:7e3,allow_dismiss:!1,animate:{enter:"animated fadeInRight",exit:"animated fadeOutRight"}})})},12e4)}handleSchemaQueried(t){this.schema=t}}