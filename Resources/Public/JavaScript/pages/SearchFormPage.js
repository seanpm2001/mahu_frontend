class SearchFormPage extends AbstractPage{constructor(e,t){super(e,t),this.MAXNUMBEROFREQTAGS=6,this.currentRequirementTags=[]}render(){super.render(),$(".searchForm .chosen-container-multi").chosen({allow_single_deselect:!0});let e=this;if(mahuUtils.querySchema().done(function(t){if(underlyingQuery){let r=[];if(underlyingQuery.q){for(let n=1;n<e.MAXNUMBEROFREQTAGS;++n){let e=underlyingQuery.q["genqf"+n];if(e){let n={from:e[0],to:e[1],unit:e[2],property:t.properties[e[3]]};r.push(n)}else{let e=underlyingQuery.q["genqft"+n];if(e){let n={from:e[0],property:t.properties[e[1]]};r.push(n)}else{let e=underlyingQuery.q["genqftemp"+n];if(e){let n={from:e[0],to:e[1],property:t.properties[e[2]]};r.push(n)}else{let e=underlyingQuery.q["genqfdq"+n];if(e){let n={from:e[0],to:e[1],property:t.properties[e[2]]};r.push(n)}}}}}for(let n=0;n<r.length;++n){let i=new RequirementTag($(".reqTagsContainer")[0],t.properties,r[n],n+1);i.addDisposeListener(e.checkButtonState,e),i.addCreatedListener(function(){$(".tx_find .searchForm button[type=submit]").click()},e),i.addRemovedListener(function(){$(".tx_find .searchForm button[type=submit]").click()},e),i.render(),e.currentRequirementTags.push(i)}e.getNextFreeRequirementID($(".reqTagsContainer"))||$("#addRequirement").addClass("disabled")}}}),this.userHistory.getTrackedQueries().length>0){$("#simpleSearchOptions").toggleClass("hasHistory"),new QueryHistoryPopup($("#queryPopup")).render()}}addRequirementTag(e,t=!1){let r=this.getNextFreeRequirementID($(".reqTagsContainer"));if(!r)return;let n=this;mahuUtils.querySchema().done(function(i){let s=new RequirementTag($(".reqTagsContainer")[0],i.properties,e,r);s.addDisposeListener(n.checkButtonState,n),s.addCreatedListener(function(){$(".tx_find .searchForm button[type=submit]").click()},n),s.addRemovedListener(function(){$(".tx_find .searchForm button[type=submit]").click()},n),s.render(),1!=t||e.from||e.to||s.edit(),n.currentRequirementTags.push(s)})}getNextFreeRequirementID(e){let t=[];for(let e=1;e<=this.MAXNUMBEROFREQTAGS;++e)t.push(e);return $(".reqTag",e).each(function(e,r){let n=r.getAttribute("data-genid");if(!n)return;let i=parseInt(n),s=t.indexOf(i);-1!=s&&t.splice(s,1)}),t.length>0?t[0]:null}checkButtonState(e){this.getNextFreeRequirementID($(".reqTagsContainer"))?$("#addRequirement").removeClass("disabled"):$("#addRequirement").addClass("disabled");let t=this.currentRequirementTags.indexOf(e);-1!=t&&this.currentRequirementTags.splice(t,1)}addListeners(){super.addListeners();let e=this;if($("#addRequirement").on("click keyup",function(t){if("keyup"==t.type&&13!=t.originalEvent.keyCode)return!0;"click"==t.type&&$(this).blur();let r=e.getNextFreeRequirementID($(".reqTagsContainer"));r&&(mahuUtils.querySchema().done(function(t){let n=Object.assign({},t.properties),i=Object.getOwnPropertyNames(t.properties);for(let r=0;r<i.length;++r){let s=t.properties[i[r]];for(let t=0;t<e.currentRequirementTags.length;++t){let r=e.currentRequirementTags[t].getPropertyID();s.id==r&&delete n[r]}}let s=new RequirementTag($(".reqTagsContainer")[0],n,null,r);s.addDisposeListener(e.checkButtonState,e),s.addCreatedListener(function(){$(".tx_find .searchForm button[type=submit]").click()},e),s.render(),e.currentRequirementTags.push(s)}),e.checkButtonState(),t.stopPropagation(),t.preventDefault())}),$(".tx_find form .hero-unit button[type='submit']").click(function(e){let t=$("input[id$='field-default']")[0];t&&""==t.value&&(t.value="*"),mahu.getKeepFacets()||$(".hiddenSelectedFacet").remove()}),this.userHistory.getTrackedQueries().length>0){$("#showQueryHistory").click(function(e){e.preventDefault(),e.stopPropagation(),$("#queryPopup").toggleClass("active")});let e=function(e){"showQueryHistory"!=e.target.id&&$("#queryPopup").hasClass("active")&&$("#queryPopup").toggleClass("active")};window.addEventListener("click",e)}$(".sortOrder select").change(function(){this.form.submit()}),$(".resultCountPicker select").change(function(){this.form.submit()}),$(".groupingSelector input, .groupingSelector select").change(function(){this.form.submit()}),$('input[id$="field-default"]').keypress(function(e){13==e.keyCode&&(mahu.getKeepFacets()||$(".hiddenSelectedFacet").remove(),this.form.submit())}),$(".inputContainer > input[type='number']").keypress(function(e){13==e.keyCode&&this.form.submit()});const t=function(t){let r=e.userHistory.getSetting("customPreviewProps");if(r&&r.length>0){let e="";for(let t=0;t<r.length;++t)e+=r[t],t!=r.length-1&&(e+=",");let n="<input class='cpp' type='hidden' name='tx_find_find[cpp]' value='"+e+"'>";$(t+" > div:first-of-type").append(n)}};0==$("form.searchForm input.cpp").length&&t("form.searchForm"),0==$("form#modifierForm input.cpp").length&&t("form#modifierForm"),$(".remarkInfo").each(function(e,t){$(t).tooltip()})}handleSchemaQueried(){}}