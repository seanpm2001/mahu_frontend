class MaterialEditorPage extends AbstractPage{render(){super.render()}addListeners(){super.addListeners();let t=this;$(".editform :input:not(textarea):not(:submit)").on("keydown",function(t){if(13==t.keyCode)return t.preventDefault(),!1}),$(".editform #abort").click(function(t){t.preventDefault(),t.stopPropagation();let e=$(this).attr("data-url");e&&(window.location=e)});let e=$("select.matcategoryselector")[0],a=[].concat(mahu.getTaxonomy().listMaterialClasses()),n=e.getAttribute("data-value");for(let t=0;t<a.length;++t){let r=a[t],i=document.createElement("option");i.value=r,i.innerHTML=r,r===n&&(i.selected="selected"),e.appendChild(i)}const r=function(t){let e=t.getAttribute("data-autocomplete"),a=mahu.getTermLink(e,"json-all");a&&jQuery.getJSON(a,function(a){let n=[],r=a.terms[e];for(let t=0;t<r.length;t+=2)n.push(r[t]);n.sort(function(t,e){return t.localeCompare(e,Localization.getLanguage(),{sensitivity:"base"})}),$(t).autocomplete({source:n,minLength:0}).focus(function(e){if(""!=e.target.value)return;let a=$.Event("keydown");a.key=40,$(t).trigger(a)})})};$("input[data-autocomplete]").each(function(t,e){r(e)}),$("#addIPSelector").chosen({allow_single_deselect:!0,max_selected_options:5}),$("#addMPSelector").chosen(),$("#addPPSelector").chosen(),$("#DDSelector").chosen(),$("#ProdSelector").chosen({allow_single_deselect:!0,max_selected_options:5}),$("#SupSelector").chosen({allow_single_deselect:!0,max_selected_options:5}),$("select.matcategoryselector").chosen();const i=function(t){let e=t.parent().find(".cloneable").length,a=t.clone();a.attr("id",""),a.removeClass("noremove");let n=$(a.find("input, textarea, select"));for(let t=0;t<n.length;++t){let a=n[t],i=a.getAttribute("data-nametemplate").replace("$num$",e),l=a.getAttribute("id")+"_"+e;a.setAttribute("name",i),a.setAttribute("id",l),$(a).val(""),a.getAttribute("data-autocomplete")&&r(a);let o=$(a).parents("div.form-group").find("label");0!=o.length&&o[0].setAttribute("for",l)}$("a.removeBtn",a).removeClass("template"),t.parent().append(a),a.find("a.removeBtn").click(function(t){o($(t.currentTarget))}),l(a),$($("input",a)[0]).focus()},l=function(e){let a=$("select.units",e);for(let e=0;e<a.length;++e){let n=a[e];$(n).empty();let r=$(n).parents("div.propertyFields")[0].getAttribute("data-pid"),i=t.schema.properties[r];if(Array.isArray(i.units))for(let t=0;t<i.units.length;++t){let e=i.units[t],a=document.createElement("option");a.value=e,a.innerHTML=e,0==t&&(a.selected="selected"),n.appendChild(a)}else{let t=document.createElement("option");t.value=i.defaultUnit,t.innerHTML=i.defaultUnit,t.selected="selected",n.appendChild(t)}}};$("a.addBtn").click(function(t){i($("#"+t.currentTarget.getAttribute("data-clonetarget")))});const o=function(t){let e=t.parent().parent();1==e.parent().find(".cloneable").length?e.hasClass("noremove")?e.find("input,textarea").val(""):e.parent().remove():e.hasClass("noremove")?e.find("input,textarea").val(""):e.remove()};$("a.removeBtn").click(function(t){o($(t.currentTarget))}),$("#addPPBtn").click(function(t){let e=$("#addPPSelector").val(),a=$("div[data-pid='"+e+"']");if(a.length>0)return void $("a.addBtn",a).click();let n=$("#physicalPropertiesTemplate > div").clone();n.find("input, textarea, select").each(function(t,a){let n=$(a);n.attr("id",n.attr("id").replace("$prop$",e)),n.attr("name",n.attr("name").replace("$prop$",e)),n.attr("data-nametemplate",n.attr("data-nametemplate").replace("$prop$",e))});let r=n.find("label.control-label");r.attr("for",r.attr("for").replace("$prop$",e)).text(Localization.getString(e)),n.find(".form-group label").each(function(t,a){a.setAttribute("for",a.getAttribute("for").replace("$prop$",e))});let c=n.find("a.addBtn");c.attr("data-clonetarget",c.attr("data-clonetarget").replace("$prop$",e));let d=n.find("div.cloneable");d.attr("id",d.attr("id").replace("$prop$",e)),$("#physicalPropertiesFieldsets").append(n),n.find("a.addBtn").click(function(t){i($("#"+t.currentTarget.getAttribute("data-clonetarget")))}),n.find("a.removeBtn").click(function(t){o($(t.currentTarget))}),n.attr("data-pid",n.attr("data-pid").replace("$prop$",e)),$($("input",n)[0]).focus(),l(n)}),$("#addMPBtn").click(function(t){let e=$("#addMPSelector").val(),a=$("div[data-pid='"+e+"']");if(a.length>0)return void $("a.addBtn",a).click();let n=$("#miscPropertiesTemplate > div").clone();n.find("input, textarea").each(function(t,a){let n=$(a);n.attr("id",n.attr("id").replace("$prop$",e)),n.attr("name",n.attr("name").replace("$prop$",e)),n.attr("data-nametemplate",n.attr("data-nametemplate").replace("$prop$",e))});let r=n.find("label.control-label");r.attr("for",r.attr("for").replace("$prop$",e)).text(Localization.getString(e));let l=n.find("a.addBtn");l.attr("data-clonetarget",l.attr("data-clonetarget").replace("$prop$",e));let c=n.find("div.cloneable");c.attr("id",c.attr("id").replace("$prop$",e)),$("#miscPropertiesFieldsets").append(n),n.find("a.addBtn").click(function(t){i($("#"+t.currentTarget.getAttribute("data-clonetarget")))}),n.find("a.removeBtn").click(function(t){o($(t.currentTarget))}),n.attr("data-pid",n.attr("data-pid").replace("$prop$",e)),$($("input",n)[0]).focus()}),setInterval(function(){let t=$("form.editform")[0];if(!t.checkValidity())return;let e=t.action.replace("tx_mahufrontend_materialeditor%5Baction%5D=edit","tx_mahufrontend_materialeditor%5Baction%5D=autosave");e=e.replace("tx_mahufrontend_materialeditor%5Baction%5D=new","tx_mahufrontend_materialeditor%5Baction%5D=autosave"),fetch(e+"&tx_mahufrontend_materialeditor[format]=data&type=1369315166",{method:t.method,body:new FormData(t)}).then(t=>t.json()).then(function(t){t.success&&$.notify({message:String.format(Localization.getString("matedit.autosave"),t.file),icon:"fa fa-save smallicon"},{type:"info",delay:7e3,allow_dismiss:!1,animate:{enter:"animated fadeInRight",exit:"animated fadeOutRight"}})})},12e4)}handleSchemaQueried(t){this.schema=t}}