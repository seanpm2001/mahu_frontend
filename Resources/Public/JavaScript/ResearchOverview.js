const ResearchOverview=function(e,t,i){const a=Object.assign({bookmarks:!0,visitedMaterials:!0,queries:!0,savedQueries:!0},i);let s=mahu.getHistory();const r=function(e,t,i){return(!t||isNaN(t)||t<0)&&(t=4),(!i||isNaN(i)||i<0)&&(i=0),o(e),e.slice(i,t)},o=function(e){return e.sort(function(e,t){return t.timestamp-e.timestamp}),e},l=function(e,t,i){let a="";for(let e=0;e<t.length;++e){let i=t[e],s=mahu.getDetailPageLink(i.id);a+='<a tabindex="0" class="materialPreview" data-id="'+i.id+'" href="'+s+'"><div class="thumbWrap" style="position:relative"><img src="'+i.imageURL+'" class="thumb" onerror="mahu.handleImageError(arguments[0])" aria-hidden="true"></img>',i.isSymbolicImage&&(a+='<p class="siOverlay">'+Localization.getString("symbolicImage")+"</p>"),a+='</div><div class="materialPreviewText"><p class="materialName">'+i.name,i.altName&&(a+="<span class='alternativeName'>"+i.altName+"</span>"),a+='</p><p class="plain">'+i.producer+"</p></div></a>"}e.html(a),e.find(".materialPreview").each(function(){let e=$(this),a=e.attr("data-id"),s=t.find(function(e){return e.id==a});new ActionsMenu(e,i,s).render()})},n=function(e){let t=+new Date-e,i="",a=!1,s="",r=Localization.getString("ro.tmpl"),o=t/6e4;if(o<1)i=Localization.getString("ro.ltm");else if(o<60){let e=Math.round(o);s+=e,i=Localization.getString("ro.minute"),1!=e&&(a=!0)}else if(o<1440){let e=Math.round(o/60);s+=e,i=Localization.getString("ro.hour"),1!=e&&(a=!0)}else{let e=Math.round(o/1440);s+=e,i=Localization.getString("ro.day"),1!=e&&(a=!0)}return String.format(r,s,i,a?Localization.getString("ro.plural"):"",Localization.getString("ro.ago"))},c=function(e,t,i){let a=t.length,s="";for(var r=0;r<a;++r){let e=t[r],i=0,a=e.asString.length,o=[],l=null;for(let t=0;t<a;++t){let a=e.asString[t];"query"!=a.type?(o.push(a),++i):l=a.propValue}let c=0;2==i?(o=o.slice(0,2),c=0):(o=o.slice(0,1),c=i-1);let u=e.resultCount;1!=e.resultCount?u+=" "+Localization.getString("ro.results"):u+=" "+Localization.getString("ro.result"),s+='<a class="queryRepresentation" href="'+mahuUtils.addLanguageParameterToURL(e.url)+'" data-id="'+e.timestamp+'" tabindex="0"><div class="materialPreviewText"><p class="materialName">&bdquo;'+l+"&ldquo;</p>";for(let e=0;e<o.length;++e){let t=o[e];s+='<p class="plain cropText">'+t.propName+": "+t.propValue+"</p>"}c>0&&(s+='<p class="plain">'+String.format(Localization.getString("ro.furtherResults"),c)+"</p>"),s+='<div class="bottom-right" style="width:100%;"><hr style="border-top: 1px solid #059;"/><p class="plain text-right"><i>'+u+'</i></p><p class="plain text-right"><i>'+n(e.timestamp)+"</i></p></div></div></a>"}e.html(s),e.find(".queryRepresentation").each(function(){let e=$(this),a=e.attr("data-id"),s=t.find(function(e){return e.timestamp==a});new ActionsMenu(e,i,s).render()})},u=function(e){let i=!1;if(e||(e=s.getBookmarks(),i=!0),e.length>0){l($("#bookmarkList"),e,{handler:function(e,t){"removeBookmark"==e&&mahu.removeBookmark(t),"compare"==e&&mahu.getMaterialSelector().addMaterial(t),"share"==e&&mahuUtils.openEMail({subject:t.name,body:mahu.getDetailPageLink(t.id,!0)})},menuOptions:[{id:"removeBookmark",label:Localization.getString("removeBookmark"),cssClasses:{icon:"far fa-bookmark smallicon"}},{id:"compare",label:Localization.getString("compare"),cssClasses:{icon:"fas fa-exchange-alt smallicon"}},{id:"share",label:Localization.getString("share"),cssClasses:{icon:"fas fa-share-alt smallicon"}}]});let a=[];s.getBookmarks().length>t&&a.push({id:i?"showbookmarksCollapse":"showbookmarks",label:i?Localization.getString("showAllBookmarksCollapse"):Localization.getString("showAllBookmarks"),cssClasses:{icon:"fas fa-bookmark smallicon"}}),a.push({id:"clearbookmarks",label:Localization.getString("removeAllBookmarks"),cssClasses:{icon:"far fa-bookmark smallicon"}},{id:"share",label:Localization.getString("share"),cssClasses:{icon:"fas fa-share-alt smallicon"}}),new ActionsMenu($("#bookmarkContainer > div:first-child"),{handler:function(i){if("showbookmarks"==i&&u(),"showbookmarksCollapse"==i&&u(r(s.getBookmarks(),t)),"clearbookmarks"==i&&mahu.getHistory().clear(history.entryTypes.BOOKMARK),"share"==i){let t="";for(let i=0;i<e.length;++i){let a=e[i];t+=a.name+": "+mahu.getDetailPageLink(a.id,!0)+"\n"}mahuUtils.openEMail({subject:Localization.getString("ro.mail.bookmarks.subject"),body:t})}},menuOptions:a,staticMenu:!0,additionalCssClasses:{button:"actionsMenuButton"}},null).render()}else $("#bookmarkContainer").hide()},h=function(e){let i=!1;if(e||(e=o(s.getPageVisits()),i=!0),e.length>0){l($("#visitedList"),e,{handler:function(e,t){"removeFromHistory"==e&&mahu.removeVisitedPage(t),"compare"==e&&mahu.getMaterialSelector().addMaterial(t),"share"==e&&mahuUtils.openEMail({subject:t.name,body:mahu.getDetailPageLink(t.id,!0)})},menuOptions:[{id:"removeFromHistory",label:Localization.getString("removeFromHistory"),cssClasses:{icon:"far fa-trash-alt smallicon"}},{id:"compare",label:Localization.getString("compare"),cssClasses:{icon:"fas fa-exchange-alt smallicon"}},{id:"share",label:Localization.getString("share"),cssClasses:{icon:"fas fa-share-alt smallicon"}}]});let a=[];s.getPageVisits().length>t&&a.push({id:i?"showvisitsCollapse":"showvisits",label:i?Localization.getString("showVisitsCollapse"):Localization.getString("showVisits"),cssClasses:{icon:"fas fa-bookmark smallicon"}}),a.push({id:"clearvisits",label:Localization.getString("removeVisits"),cssClasses:{icon:"far fa-trash-alt smallicon"}},{id:"share",label:Localization.getString("share"),cssClasses:{icon:"fas fa-share-alt smallicon"}}),new ActionsMenu($("#visitedSitesContainer > div:first-child"),{handler:function(i){if("showvisits"==i&&h(),"showvisitsCollapse"==i&&h(r(s.getPageVisits().reverse(),t)),"clearvisits"==i&&mahu.getHistory().clear(history.entryTypes.PAGEVISIT),"share"==i){let t="";for(let i=0;i<e.length;++i){let a=e[i];t+=a.name+": "+mahu.getDetailPageLink(a.id,!0)+"\n"}mahuUtils.openEMail({subject:Localization.getString("ro.mail.pageVisits.subject"),body:t})}},menuOptions:a,staticMenu:!0,additionalCssClasses:{button:"actionsMenuButton"}},null).render()}else $("#visitedSitesContainer").hide()},m=function(e){let i=!1;if(e||(e=o(s.getTrackedQueries()),i=!0),e.length>0){e.forEach(function(e){e.asString=mahuUtils.queryToString(e)}),c($("#queryList"),e,{handler:function(e,t){"removeQueryFromHistory"==e&&mahu.getHistory().removeTrackedQuery(t),"share"==e&&mahuUtils.openEMail({subject:Localization.getString("ro.mail.query.subject"),body:String.format(Localization.getString("ro.mail.query.content"),new Date(t.timestamp),t.resultCount,t.url)})},menuOptions:[{id:"removeQueryFromHistory",label:Localization.getString("removeQuery"),cssClasses:{icon:"far fa-trash-alt smallicon"}},{id:"share",label:Localization.getString("share"),cssClasses:{icon:"fas fa-share-alt smallicon"}}]});let a=[];s.getTrackedQueries().length>t&&a.push({id:i?"showqueriesCollapse":"showqueries",label:i?Localization.getString("showQueriesCollapse"):Localization.getString("showQueries"),cssClasses:{icon:"fas fa-history smallicon"}}),a.push({id:"clearqueries",label:Localization.getString("removeQueries"),cssClasses:{icon:"far fa-trash-alt smallicon"}},{id:"share",label:Localization.getString("share"),cssClasses:{icon:"fas fa-share-alt smallicon"}}),new ActionsMenu($("#searchQueriesContainer > div:first-child"),{handler:function(i){if("showqueries"==i&&m(),"showqueriesCollapse"==i&&m(r(s.getTrackedQueries().reverse(),t)),"clearqueries"==i&&mahu.getHistory().clear(history.entryTypes.TRACKEDQUERY),"share"==i){let t="";for(let i=0;i<e.length;++i){let a=e[i];t+=String.format(Localization.getString("ro.mail.query.content"),new Date(a.timestamp),a.resultCount,a.url)+"\n"}mahuUtils.openEMail({subject:Localization.getString("ro.mail.queries.subject"),body:t})}},menuOptions:a,staticMenu:!0,additionalCssClasses:{button:"actionsMenuButton"}},null).render()}else $("#searchQueriesContainer").hide()},g=function(e){let i=!1;if(e||(e=o(s.getQueries()),i=!0),e.length>0){e.forEach(function(e){e.asString=mahuUtils.queryToString(e)}),c($("#savedQueryList"),e,{handler:function(e,t){"removeQueryFromHistory"==e&&mahu.getHistory().removeQuery(t),"share"==e&&mahuUtils.openEMail({subject:Localization.getString("ro.savedQuery.subject"),body:String.format(Localization.getString("ro.savedQuery.content"),new Date(t.timestamp),t.resultCount,t.url)})},menuOptions:[{id:"removeQueryFromHistory",label:Localization.getString("removeQuery"),cssClasses:{icon:"far fa-trash-alt smallicon"}},{id:"share",label:Localization.getString("share"),cssClasses:{icon:"fas fa-share-alt smallicon"}}]});let a=[];s.getQueries().length>t&&a.prepend({id:i?"showqueriesCollapse":"showqueries",label:i?Localization.getString("showAllQueriesCollapse"):Localization.getString("showAllQueries"),cssClasses:{icon:"fas fa-history smallicon"}}),a.push({id:"clearqueries",label:Localization.getString("removeAllQueries"),cssClasses:{icon:"far fa-trash-alt smallicon"}},{id:"share",label:Localization.getString("share"),cssClasses:{icon:"fas fa-share-alt smallicon"}}),new ActionsMenu($("#savedSearchQueriesContainer > div:first-child"),{handler:function(i){if("showqueries"==i&&g(),"showqueriesCollapse"==i&&g(r(s.getQueries().reverse(),t)),"clearqueries"==i&&mahu.getHistory().clear(history.entryTypes.QUERY),"share"==i){let t="";for(let i=0;i<e.length;++i){let a=e[i];t+=String.format(Localization.getString("ro.mail.savedQueries.content"),new Date(a.timestamp),a.resultCount,a.url)}mahuUtils.openEMail({subject:Localization.getString("ro.mail.savedQueries.subject"),body:t})}},menuOptions:a,staticMenu:!0,additionalCssClasses:{button:"actionsMenuButton"}},null).render()}else $("#savedSearchQueriesContainer").hide()},d=function(){if(a.bookmarks){let e=r(s.getBookmarks(),t);u(e),s.addListener(history.entryTypes.BOOKMARK,history.eventTypes.ALL,function(){$("#bookmarkList").html(""),$("#history").hide(),d()},this)}if(a.visitedMaterials){let e=r(s.getPageVisits().reverse(),t);h(e),s.addListener(history.entryTypes.PAGEVISIT,history.eventTypes.ALL,function(){$("#visitedList").html(""),$("#history").hide(),d()},this)}if(a.queries){let e=r(s.getTrackedQueries().reverse(),t);m(e),s.addListener(history.entryTypes.TRACKEDQUERY,history.eventTypes.ALL,function(){$("#queryList").html(""),$("#history").hide(),d()},this)}if(a.savedQueries){let e=r(s.getQueries().reverse(),t);g(e),s.addListener(history.entryTypes.QUERY,history.eventTypes.ALL,function(){$("#savedQueryList").html(""),$("#history").hide(),d()},this)}$("#history").show()};return{render:d}};