const CompareView=function(e,t){let a=null,i=null,r=[],n=[],o=[];e.forEach(function(e){n.push(e.nameTrade_value||e.name),o.push(e.altName)});let l=[],c=[];e.forEach(function(e){c.push(e.dataDeliverer)}),l.push({name:Localization.getString("dataDeliverer"),values:c});const s=function(e,t,a,i){if(!t&&!a&&!i)return"";let r="",n=!1;return Array.isArray(t)&&t.length>=e&&(r+=t[e],n=!0),Array.isArray(a)&&a.length>=e&&(n&&(r+=", "),r+=a[e],n=!0),Array.isArray(i)&&i.length>=e&&(n&&(r+=", "),r+=i[e]),r.trim().length>0?'<i class="fas fa-info-circle propertyInfo" tabindex="0" title="'+r+'"></i>':""};Object.getOwnPropertyNames(t.miscProperties).forEach(function(a){let i=t.miscProperties[a];if(i.hideInComparison)return;let r=[];e.forEach(function(e){let t=e[a],n="";if(Array.isArray(t)){let e=t.length;if("category"==a)n=t[e-1];else for(let a=0;a<e;++a)n+=t[a],a!=e-1&&(n+=", ")}else n=t;n=n||"-",t&&i.defaultUnit&&(n+=i.defaultUnit),r.push(n)});let n=!1;for(var o=0;o<r.length;++o)if(r[o]&&"-"!=r[o]){n=!0;break}n&&l.push({name:Localization.getString(a),values:r})}),Object.getOwnPropertyNames(t.properties).forEach(function(a){let i=t.properties[a];if(i.hideInComparison)return;let r=[],n=[];e.forEach(function(e){let t="",o=e[a+"_value_min"],l=e[a+"_value_max"],c=e[a+"_value"],u=e[a+"_unit"],d=e[a+"_remark"],m=e[a+"_substance"],p=e[a+"_norm"],h=e[a+"_method"],f=e[a+"_testCondition"];if(i.isMultivalued){c&&!Array.isArray(c)&&(c=[c]),o&&!Array.isArray(o)&&(o=[o]),l&&!Array.isArray(l)&&(l=[l]);let e=0;c?e=c.length||1:o?e=o.length||1:l&&(e=l.length||1);for(let a=0;a<e;++a){let r=c?c[a]:void 0,n=o?o[a]:void 0,g=l?l[a]:void 0,y=u?u[a]:i.defaultUnit||"";r&&"NaN"!=r?i.isQualitative&&m?t+=m[a]+": "+c[a]+" "+y:t+=c[a]+" "+y:d&&d[a]&&"-"!=d[a]?t+="("+d[a]+")":(n&&"NaN"!=n||!g||"NaN"==g||(t+="&#x003C;&#160;"+g+" "+y),!n||"NaN"==n||g&&"NaN"!=g||(t+="&#x003E;&#160;"+n+" "+y),n&&"NaN"!=n&&g&&"NaN"!=g&&(t+=n+" - "+g+" "+y)),t+=s(a,p,h,f),a!=e-1&&(t+=",<br/> ")}}else o&&"NaN"!=o||l&&"NaN"!=l?(o&&"NaN"!=o||!l||(t="&#x003C;&#160;"+l),!o||l&&"NaN"!=l||(t="&#x003E;&#160;"+o),"NaN"!=o&&"NaN"!=l&&(t=o+" - "+l),t+=" "+(u||i.defaultUnit||"")):(null!=c&&void 0!=c&&"NaN"!=c?(t=c,t+=" "+(u||i.defaultUnit||"")):d&&(t+="("+d+")"),i.isQualitative&&m&&(t=m+": "+t)),t+=s(0,p,h,f);r.push(t),n.push(e.obfuscate)});let o=!1;for(var c=0;c<r.length;++c)if(r[c]&&"-"!=r[c]){o=!0;break}o&&l.push({name:Localization.getString(a),values:r,obfuscate:n})});const u=function(){document.body.removeChild(i),document.body.removeChild(a),window.onresize=null,$("body").removeClass("noscroll"),p(null,CompareView.eventTypes.CLOSED)},d=function(e){e.css({left:Math.max(($("body").width()-e.outerWidth())/2,0),top:Math.max((window.innerHeight-e.outerHeight())/2,0)})},m=function(e,t,a){let i=-1;for(let n=0;n<r.length;++n){let o=r[n];if(o.eventType==e&&o.handler==t&&o.scope==a){i=n;break}}return i},p=function(e,t){r.forEach(function(a){if(a.eventType&&a.eventType==t||a.eventType==CompareView.eventTypes.ALL||!a.eventType)try{a.handler.call(a.scope,e,t)}catch(e){console.error(e)}})};return{render:function(){(a=document.createElement("div")).id="overlay",a.classList.add("overlay"),document.body.append(a),(i=document.createElement("div")).id="compareViewContainer",document.body.append(i);let t='<div style="text-align:right"><a id="compareViewCloseRightUpper" tabindex="0"><i class="fas fa-times" aria-hidden="true"></i></a></div><div style="overflow:auto"><table id="comparisonTable" class="propertiesTable"><thead><tr><th><h3>'+Localization.getString("compView.heading")+"</h3></th>";for(var r=0;r<e.length;++r){t+="<th>";let a=e[r].imageURL;if(!e[r].isSymbolicImage&&a&&-1===a.indexOf(mahu.getImageLinkResolver().getDefaultImageURL()))t+='<div class="thumbWrap"><img src="'+a+'" class="thumb"></img></div>';else{let a=null;e[r].category&&(a=e[r].category[e[r].category.length-1],mahu.getTaxonomy().getMaterialClass(a)||(a=e[r].category[e[r].category.length-2])),t+='<div class="thumbWrap" style="position:relative"><img src="'+mahu.getTaxonomy().getImage(a)+'" class="thumb"></img><p class="siOverlay">'+Localization.getString("symbolicImage")+"</p></div>",e[r].isSymbolcImage=!0}}t+="</tr><tr><th>"+Localization.getString("compView.property")+"</th>";for(r=0;r<e.length;++r){let a=mahu.getDetailPageLink(e[r].id);t+="<th>",t+='<div class="cropText"><a class="detailPageLink" data-mid="'+e[r].id+'" href="'+a+'"><i class="fas fa-search smallicon" aria-hidden="true"></i>'+n[r]+(o[r]?" "+o[r]:"")+"</a></div></th>"}t+="</tr></thead><tbody>",l.forEach(function(e){t+="<tr><td>"+e.name+"</td>";for(var a=0;a<e.values.length;++a)t+="<td",e.obfuscate&&e.obfuscate[a]&&(t+=' class="blurred"'),t+=">"+e.values[a]+"</td>";t+="</tr>"}),t+="</tbody></table></div>",t+='<div class="buttonbar"><button id="compare-back" class="btn btn-primary">'+Localization.getString("compView.back")+"</button>",t+='<button id="compare-close" class="btn btn-primary">'+Localization.getString("compView.close")+"</button>",t+='<button id="compare-export" class="btn btn-primary">'+Localization.getString("ExportCSV")+"</button>",t+="</div>";let c=$("#compareViewContainer");c.html(t),c.find("#compareViewCloseRightUpper").on("click keyup",function(e){"keyup"===e.type&&13!=e.keyCode||u()}),$("#compare-close").click(function(){u()}),$("#compare-back").click(function(){u();let t=mahu.getMaterialSelector();for(let a=0;a<e.length;++a){let i=e[a],r=i.nameTrade_value||i.name,n={id:i.id,category:i.category,link:i.link,imageURL:i.imageURL,isSymbolicImage:i.isSymbolicImage,producer:i.producer,query:i.query,name:r,altName:i.altName};t.addMaterial(n)}t.show()}),$("#compare-export").click(function(){let e=[];$("#comparisonTable thead tr:nth-child(2) th").each(function(t,a){e.push(a.textContent)});let t=$("#comparisonTable").table2CSV({delivery:"value",separator:";",header:e}),a=["\ufeff"].concat(t.split("\n"));for(let e=0;e<a.length;++e)a[e]+="\n";mahuUtils.saveBlobAsFile("comparison.csv",a)}),$(".detailPageLink").on("click keyup",function(t){if("keyup"===t.type&&13!=t.keyCode)return;let a=$(this).attr("data-mid"),i=null;e.forEach(function(e){e.id==a&&(i=e.query)}),i&&sessionStorage.setItem("RELATED_QUERY",JSON.stringify(i))}),d(c),window.onresize=function(){d(c)},$("body").addClass("noscroll")},addListener:function(e,t,a){if(!$.isFunction(t))return!1;return-1==m(e,t,a)&&(r.push({eventType:e,handler:t,scope:a}),!0)},removeListener:function(e,t,a){let i=m(e,t,a);return-1!=i&&(r.splice(i,1),!0)}}};Object.defineProperties(CompareView,{eventTypes:{value:Object.defineProperties({},{CLOSED:{value:"remove",configurable:!1,enumerable:!0,writable:!1},ALL:{value:"all",configurable:!1,enumerable:!0,writable:!1}}),writeable:!1,enumerable:!0,configurable:!1}});