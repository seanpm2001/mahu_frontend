const QueryHistoryPopup=function(t,e){let i=mahu.getHistory();const r=function(t){return t.sort(function(t,e){return e.timestamp-t.timestamp}),t},n=function(t){let e=+new Date-t,i="",r=!1,n="",a=Localization.getString("ro.tmpl"),o=e/6e4;if(o<1)i=Localization.getString("ro.ltm");else if(o<60){let t=Math.round(o);n+=t,i=Localization.getString("ro.minute"),1!=t&&(r=!0)}else if(o<1440){let t=Math.round(o/60);n+=t,i=Localization.getString("ro.hour"),1!=t&&(r=!0)}else{let t=Math.round(o/1440);n+=t,i=Localization.getString("ro.day"),1!=t&&(r=!0)}return String.format(a,n,i,r?Localization.getString("ro.plural"):"",Localization.getString("ro.ago"))},a=function(e){e||(e=r(i.getTrackedQueries())),e.length>0?(e.forEach(function(t){t.asString=mahuUtils.queryToString(t)}),function(t,e){let i=e.length,r="";for(let t=0;t<i;++t){let i=e[t],a=0,o=i.asString.length,l=null;for(let t=0;t<o;++t){let e=i.asString[t];"query"!=e.type?++a:l=e.propValue}let s=i.resultCount;1!=i.resultCount?s+=" "+Localization.getString("ro.results"):s+=" "+Localization.getString("ro.result"),r+='<a tabindex="0" class="queryPopupEntry" href="'+mahuUtils.addLanguageParameterToURL(i.url)+'" data-id="'+i.timestamp+'"><div style="padding: 5px"><p class="cropText">&bdquo;'+l+'&ldquo;</p><div><p style="font-size: 0.8em" class="plain text-right">'+(a>0?a+" "+Localization.getString("filters")+" | ":"")+s+" | "+n(i.timestamp)+"</p></div></div></a>"}r+='<a tabindex="0" class="queryPopupEntry" href="'+mahu.getMaterialSearchPageURL()+'#researchHistory" ><div style="padding: 5px"><div><p>'+Localization.getString("showResearchOverview")+"</p></div></div></a>",t.html(r)}(t.find(".queryList"),e)):$("#searchQueriesContainer").hide()},o=function(){let t=(n=i.getTrackedQueries().reverse(),(!(l=e)||isNaN(l)||l<0)&&(l=4),(!s||isNaN(s)||s<0)&&(s=0),r(n),n.slice(s,l));var n,l,s;a(t),i.addListener(history.entryTypes.TRACKEDQUERY,history.eventTypes.ALL,function(){$("#queryList").html(""),$("#history").hide(),o()},this)};return{render:o}};